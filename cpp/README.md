# Windows HDD Collector (C++)

Версия проекта на C++ для автоматического сбора информации о жестких дисках на Windows ПК и отправки данных на сервер Flask по HTTP.

## Возможности

- ✅ Сбор информации о всех физических дисках через WMI
- ✅ Автоматическая отправка данных на сервер по HTTP POST
- ✅ Сохранение данных в JSON файл
- ✅ Поддержка конфигурационных файлов
- ✅ Автоматическое определение производителя и типа диска
- ✅ Нативный код без зависимостей от Python

## Требования

- Windows 7/8/10/11
- Visual Studio 2019 или выше (или компилятор с поддержкой C++17)
- CMake 3.10 или выше
- Права администратора (для доступа к WMI)

## Сборка проекта

### Вариант 1: Visual Studio

1. Откройте папку `cpp` в Visual Studio
2. Выберите конфигурацию (Release/Debug)
3. Соберите проект (Build Solution или F7)
4. Исполняемый файл будет в `cpp/bin/HDDCollector.exe`

### Вариант 2: CMake командная строка

```bash
cd cpp
mkdir build
cd build
cmake ..
cmake --build . --config Release
```

Исполняемый файл будет в `cpp/build/bin/HDDCollector.exe`

### Вариант 3: CMake GUI

1. Откройте CMake GUI
2. Укажите source code: `путь_к_проекту/cpp`
3. Укажите build directory: `путь_к_проекту/cpp/build`
4. Нажмите Configure
5. Выберите генератор (Visual Studio, MinGW и т.д.)
6. Нажмите Generate
7. Откройте проект в выбранной IDE и соберите

## Использование

### Базовое использование

```bash
HDDCollector.exe --host 192.168.1.100 --port 5000
```

### Параметры командной строки

- `--host HOST` - IP адрес или доменное имя сервера (по умолчанию: localhost)
- `--port PORT` - Порт сервера (по умолчанию: 5000)
- `--save FILE` - Сохранить данные в JSON файл перед отправкой
- `--config FILE` - Путь к файлу конфигурации
- `--help, -h` - Показать справку

### Примеры

```bash
# Отправка на удаленный сервер
HDDCollector.exe --host 192.168.1.100 --port 5000

# Сохранение данных в файл
HDDCollector.exe --host 192.168.1.100 --save hdd_data.json

# Использование конфигурационного файла
HDDCollector.exe --config config.json
```

## Конфигурационный файл

Создайте файл `config.json`:

```json
{
  "host": "192.168.1.100",
  "port": 5000
}
```

Затем запустите:

```bash
HDDCollector.exe --config config.json
```

## Структура проекта

```
cpp/
├── CMakeLists.txt          # Файл конфигурации CMake
├── README.md               # Эта документация
├── BUILD.md                # Инструкции по сборке
└── src/
    ├── main.cpp            # Главный файл
    ├── hdd_collector.h     # Заголовочный файл основного класса
    ├── hdd_collector.cpp   # Реализация основного класса
    ├── wmi_helper.h        # Заголовочный файл для работы с WMI
    ├── wmi_helper.cpp      # Реализация работы с WMI
    ├── http_client.h       # Заголовочный файл HTTP клиента
    ├── http_client.cpp     # Реализация HTTP клиента
    ├── json_helper.h       # Заголовочный файл для работы с JSON
    └── json_helper.cpp     # Реализация генерации JSON
```

## Собираемая информация

Для каждого жесткого диска собирается:

- **Модель** - модель диска
- **Серийный номер** - уникальный серийный номер
- **Объем** - объем диска в ГБ
- **Производитель** - производитель диска
- **Интерфейс** - тип интерфейса (SATA, SAS, NVMe)
- **Тип** - тип диска (HDD, SSD, SAS)

## API Endpoint

Сервер должен иметь endpoint: `POST http://<server>:<port>/api/hdd_collect`

### Формат отправляемых данных

```json
{
  "hostname": "PC-NAME",
  "timestamp": "2025-11-22T15:30:00",
  "platform": "Windows-10-10.0.19041-SP0",
  "disks": [
    {
      "model": "WD5003ABYX",
      "serial_number": "WMAYP3205431",
      "size_gb": 500,
      "manufacturer": "Western Digital",
      "interface": "SATA",
      "media_type": "Fixed hard disk media"
    }
  ]
}
```

## Автоматизация

### Планировщик задач Windows

1. Откройте "Планировщик задач" (Task Scheduler)
2. Создайте новую задачу
3. Настройте триггер (например, ежедневно в 9:00)
4. В действии укажите:
   - **Программа:** `C:\path\to\HDDCollector.exe`
   - **Аргументы:** `--host 192.168.1.100`
   - **Рабочая папка:** `C:\path\to\cpp\bin`
5. В настройках безопасности выберите "Запускать с наивысшими правами"

## Устранение неполадок

### Ошибка подключения к серверу

- Проверьте, что сервер запущен и доступен
- Проверьте настройки firewall
- Убедитесь, что указан правильный IP и порт
- Проверьте сетевое подключение: `ping <server_ip>`

### Ошибка получения данных о дисках

- Убедитесь, что программа запущена от имени администратора
- Проверьте доступность WMI: `wmic diskdrive list brief`

### Ошибка компиляции

- Убедитесь, что установлен CMake 3.10+
- Убедитесь, что компилятор поддерживает C++17
- Проверьте, что установлены все необходимые компоненты Windows SDK

## Сравнение с Python версией

### Преимущества C++ версии:

- ✅ Нет зависимости от Python и внешних библиотек
- ✅ Меньший размер исполняемого файла
- ✅ Быстрее работает
- ✅ Один исполняемый файл для распространения

### Преимущества Python версии:

- ✅ Проще в разработке и отладке
- ✅ Поддержка S.M.A.R.T. данных через smartctl
- ✅ Больше возможностей для расширения

## Лицензия

MIT License

## Автор

Создано для системы учета ТМЦ Flask TMC App

